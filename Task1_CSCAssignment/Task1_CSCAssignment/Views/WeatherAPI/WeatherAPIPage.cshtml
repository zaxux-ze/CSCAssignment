@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title></title>
    <script src="~/Scripts/jquery-3.3.1.min.js"></script>
</head>
<body>
    <header class="seats-header">
        <h1>Weather</h1>
    </header>

    <div><a href="#" class="get_weather">Get weather</a></div>
    <div class="get_weather_table">
        <div class="row">
            <div class="col-md-12">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>Area</th>
                            <th>Forecast</th>
                        </tr>
                    </thead>
                    <tbody id="weatherForecastTableBody"></tbody>
                </table>
            </div>
        </div>
    </div>
    
    <script type="text/javascript">

        jQuery(function ($) {
            $('div.get_weather_table').hide();
            let $tableBodyElement = $('#weatherForecastTableBody');
            let $cellElement = null;
            let $rowElement = null;
            let area = null;
            let areaForecast = null;
            next = false;

            function getWeather() {

                $.ajax({
                    method: 'GET',
                    url: 'https://api.data.gov.sg/v1/environment/2-hour-weather-forecast',
                    dataType: 'json',
                    success: function (result) {
                        console.log(result)
                        weatherData = result.items[0]
                        forecast = weatherData.forecasts
                        len = Object.keys(forecast).length;
                        for (let index = 0; index < len; index++) {
                            regionData = forecast[index]
                            for (let [key, value] of Object.entries(regionData)) {
                                if (key === 'area') {
                                    area = value
                                    next = true
                                }

                                else {
                                    areaForecast = value
                                    next = false
                                }
                            }
                            if (next === false) {
                                $rowElement = $('<tr></tr>');
                                $cellElement = $('<td></td>', { text: area });
                                $rowElement.append($cellElement);
                                $cellElement = $('<td></td>', { text: areaForecast });
                                $rowElement.append($cellElement);
                                $tableBodyElement.append($rowElement);
                            }
                        }
                    }
                });
            }

            $('a.get_weather').click(function (e) {
                e.preventDefault();
                $(this).hide();
                getWeather();
                $('div.get_weather_table').fadeIn(1000);
            });

            $('a.hide').click(function (e) {
                e.preventDefault();
                $('div.get_weather_table').hide();
                $('a.get_weather').show();
            })

        })

    </script>
</body>

</html>
