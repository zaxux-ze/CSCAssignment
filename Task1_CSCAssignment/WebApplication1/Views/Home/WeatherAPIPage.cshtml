<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
    <title>CSC Task 1</title>
    @*<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>*@
</head>
<body>
    <div class="row">
        <div class="col-md-12">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>Area</th>
                        <th>Forecast</th>
                    </tr>
                </thead>
                <tbody id="weatherForecastTableBody"></tbody>
            </table>
        </div>
    </div>
</body>
</html>

@section scripts{
<script>

    jQuery(function ($) {

        getWeather();
        let $tableBodyElement = $('#weatherForecastTableBody');
        let $cellElement = null;
        let $rowElement = null;
        let area = null;
        let areaForecast = null;
        next = false;

        function getWeather() {
            $.ajax({
                method: 'GET',
                url: 'https://api.data.gov.sg/v1/environment/2-hour-weather-forecast',
                dataType: 'json',
                success: function (result) {
                    console.log(result)
                    weatherData = result.items[0]
                    forecast = weatherData.forecasts
                    len = Object.keys(forecast).length;
                    for (let index = 0; index < len; index++) {
                        regionData = forecast[index]
                        for (let [key, value] of Object.entries(regionData)) {
                            if (key === 'area') {
                                area = value
                                next = true
                            }

                            else {
                                areaForecast = value
                                next = false
                            }
                        }
                        if (next === false) {
                            $rowElement = $('<tr></tr>');
                            $cellElement = $('<td></td>', { text: area });
                            $rowElement.append($cellElement);
                            $cellElement = $('<td></td>', { text: areaForecast });
                            $rowElement.append($cellElement);
                            $tableBodyElement.append($rowElement);
                        }
                    }
                }
            });
        }
        

    })
</script>

}